server {
    listen 443 ssl;

    server_name gapi.xhproxy.org;  # 替换为你的域名或IP地址

    # 引入共享的 SSL 配置
    include conf.d/ssl_params.conf;

    # 建议为 Nginx 配置 DNS 解析器，以便解析上游域名
    # 这里使用 Google 的公共 DNS 服务器作为示例
    resolver 8.8.8.8 8.8.4.4 valid=300s;
    resolver_timeout 5s;

    location / {
        # 将请求代理到 Google API
        proxy_pass https://generativelanguage.googleapis.com;

        # 重写 Host 头，使其与目标服务器匹配
        proxy_set_header Host generativelanguage.googleapis.com;

        # 启用 SNI 支持，这对于 HTTPS 代理至关重要
        proxy_ssl_server_name on;

        # 建议关闭缓冲，以便处理流式 API 响应
        proxy_buffering off;
    }
}
